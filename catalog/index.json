{
  "$schema": "consumer-example/patterns.manifest.schema.json",
  "version": "v2025.12.28.1",
  "last_updated": "2025-12-28",
  "changelog_summary": "VSA.Framework統合: NuGetパッケージ参照、.NET 9.0対応",
  "description": "VSA.Framework Pattern Catalog - DDD + CQRS + Vertical Slice Architecture",
  "repository": "https://github.com/your-org/VSA.Framework",
  "runtime_requirements": {
    "dotnet_version": "net9.0",
    "dotnet_sdk_minimum": "9.0.100",
    "support_until": "2026-11-10",
    "note": ".NET 9.0 を使用。VSA.Frameworkの全NuGetパッケージはこのバージョンで動作します。",
    "ai_instruction": "プロジェクト作成時は dotnet new blazor --framework net9.0 を使用。パッケージバージョンは 9.x を選択。",
    "compatible_nuget_versions": {
      "VSA.Kernel": "1.3.0",
      "VSA.Application": "1.3.0",
      "VSA.Infrastructure": "1.3.0",
      "VSA.Handlers": "1.3.0",
      "VSA.Blazor": "1.3.0"
    }
  },
  "nuget_dependencies": {
    "description": "VSA.Frameworkを使用する場合のNuGetパッケージ依存関係",
    "packages": {
      "core": [
        { "name": "VSA.Kernel", "version": "1.3.0", "purpose": "DDD基盤（Entity, ValueObject, BoundaryDecision）" },
        { "name": "VSA.Application", "version": "1.3.0", "purpose": "CQRS基盤（Command, Query, Result）" }
      ],
      "optional": [
        { "name": "VSA.Infrastructure", "version": "1.3.0", "purpose": "Pipeline Behaviors（Validation, Transaction等）" },
        { "name": "VSA.Handlers", "version": "1.3.0", "purpose": "汎用ハンドラー（CreateEntityHandler等）" },
        { "name": "VSA.Blazor", "version": "1.3.0", "purpose": "Blazor基盤（ListPageBase, FormPageBase）" }
      ]
    }
  },
  "phase_guidance": {
    "description": "計画フェーズと実装フェーズでのカタログの使い分け",
    "phases": {
      "planning": {
        "description": "要求分析、パターン選択、組み合わせ決定、影響範囲評価",
        "key_files": [
          "catalog/planning/PLANNING_GUIDE.md",
          "catalog/planning/pattern-combinations.yaml",
          "catalog/planning/handoff-template.yaml"
        ],
        "focus": [
          "ai_decision_matrix でパターンカテゴリを特定",
          "domain_hints でドメイン固有パターンを追加",
          "nonfunctional_pattern_hints で非機能要件パターンを選択",
          "依存関係に基づいて適用順序を決定",
          "Boundary設計（UIがある場合は必須）"
        ],
        "output": "計画書（適用パターン一覧、適用順序、影響範囲）"
      },
      "implementation": {
        "description": "計画に基づいたコード生成、テンプレート適用、検証",
        "key_files": [
          "catalog/implementation/IMPLEMENTATION_GUIDE.md",
          "各パターンのYAMLファイル（implementation.template）"
        ],
        "focus": [
          "パターンYAMLの implementation.template を使用",
          "テンプレート変数を置換してコード生成",
          "ai_guidance.common_mistakes を確認",
          "evidence で実装例を参照"
        ],
        "output": "実装コード"
      }
    },
    "workflow": {
      "step1": "計画フェーズ: PLANNING_GUIDE.md に従ってパターンを選択",
      "step2": "引き継ぎ: handoff-template.yaml で計画書を作成",
      "step3": "承認: ユーザーに計画を提示して承認を得る",
      "step4": "実装フェーズ: IMPLEMENTATION_GUIDE.md に従ってコードを生成"
    }
  },
  "ai_bootstrap": {
    "description": "AIが実装/計画を開始する前の必須スキャン順序（運用ガードレール）",
    "scan_order": [
      "1. unsupported_intents のキーワードを最初にスキャン → 該当なら primary 選択より先に止まって確認",
      "2. planning_required_conditions をチェック → 計画フェーズが必要なら planning に遷移",
      "3. ai_decision_matrix で primary（pattern_category/Feature/Query/Behavior）を選択",
      "4. 選択したパターンYAMLの ai_selection_hints / dependencies / conflicts を確認"
    ],
    "priority_reading_order": [
      {
        "order": 1,
        "file": "catalog/scaffolds/project-structure.yaml",
        "purpose": "project_structure",
        "description": "標準プロジェクト構造（VSA.Framework NuGet使用）",
        "required": true,
        "phases": ["planning", "implementation"]
      },
      {
        "order": 2,
        "file": "CLAUDE.md",
        "purpose": "critical_constraints",
        "description": "実装ルール・禁止事項・クイックリファレンス",
        "required": true,
        "phases": ["planning", "implementation"]
      },
      {
        "order": 3,
        "file": "catalog/COMMON_MISTAKES.md",
        "purpose": "common_mistakes",
        "description": "頻出する実装ミス（SaveChangesAsync、Value Object比較、Boundary判定）",
        "required": true,
        "phases": ["implementation"]
      },
      {
        "order": 4,
        "file": "catalog/AI_USAGE_GUIDE.md",
        "purpose": "implementation_guide",
        "description": "詳細な実装ガイド・アーキテクチャ全体像",
        "required": true,
        "phases": ["planning", "implementation"]
      },
      {
        "order": 5,
        "file": "catalog/index.json",
        "purpose": "pattern_index",
        "description": "パターン索引・意思決定マトリクス",
        "required": true,
        "phases": ["planning", "implementation"]
      }
    ],
    "critical_constraints": {
      "never_do": [
        "Handler内でSaveChangesAsync()を呼ばない（TransactionBehaviorが自動実行）",
        "SingletonでDbContextやScopedサービスを注入しない",
        "MediatRのHandleメソッド名をHandleAsyncにしない",
        "独自のCQRS基盤を作らない（VSA.Application + MediatRを使用）",
        "例外をthrowしてエラーを伝播しない（Result<T>を使用）",
        "Features/{Feature}/UI/ サブフォルダを作らない（同列配置）"
      ],
      "always_do": [
        "VSA.FrameworkのNuGetパッケージを使用",
        "CommandはResult<T>を返す",
        "サービスはScopedで登録",
        "パターンのYAMLを読んでから実装",
        "機能固有UIは Features/{Feature}/ に .cs と同列配置"
      ]
    }
  },
  "categories": {
    "kernel": {
      "name": "Kernel (DDD Foundations)",
      "description": "DDD基盤型（Entity, ValueObject, Result）。VSA.Kernelパッケージで提供。",
      "scope": "全パターン共通",
      "priority": "critical",
      "nuget_package": "VSA.Kernel"
    },
    "scaffold": {
      "name": "Scaffolds",
      "description": "新規プロジェクト作成時の標準構造・テンプレート",
      "scope": "プロジェクト全体"
    },
    "pipeline-behavior": {
      "name": "Pipeline Behaviors",
      "description": "MediatR パイプラインで実行される横断的関心事。VSA.Infrastructureパッケージで提供。",
      "execution_order": "order_hint に従って実行される",
      "nuget_package": "VSA.Infrastructure"
    },
    "feature-slice": {
      "name": "Feature Slices",
      "description": "完全な垂直スライス（Application + UI + API）",
      "scope": "複数レイヤーにまたがる機能全体"
    },
    "query-pattern": {
      "name": "Query Patterns",
      "description": "データ取得パターン（CQRS の Query 側）。VSA.Handlersで汎用実装を提供。",
      "nuget_package": "VSA.Handlers"
    },
    "command-pattern": {
      "name": "Command Patterns",
      "description": "データ変更パターン（CQRS の Command 側）。VSA.Handlersで汎用実装を提供。",
      "nuget_package": "VSA.Handlers"
    },
    "domain-pattern": {
      "name": "Domain Patterns",
      "description": "ドメインモデルの実装パターン。VSA.Kernelの基盤を活用。",
      "nuget_package": "VSA.Kernel"
    },
    "ui-pattern": {
      "name": "UI Patterns",
      "description": "Blazor UI の実装パターン。VSA.Blazorパッケージで基盤を提供。",
      "nuget_package": "VSA.Blazor"
    }
  },
  "patterns": [
    {
      "id": "result-pattern",
      "name": "Result Pattern (Railway Oriented Programming)",
      "category": "kernel",
      "version": "1.0.0",
      "file": "kernel/result-pattern.yaml",
      "intent": "例外に頼らないエラーハンドリングの基盤。すべてのCommand/Queryの戻り値として使用。",
      "tags": ["kernel", "error-handling", "result", "railway", "foundation"],
      "stability": "stable",
      "nuget_package": "VSA.Application"
    },
    {
      "id": "value-object",
      "name": "ValueObject Base Class (DDD Foundation)",
      "category": "kernel",
      "version": "1.0.0",
      "file": "kernel/value-object.yaml",
      "intent": "値による同一性を持つ不変オブジェクトの基底クラス。",
      "tags": ["kernel", "value-object", "ddd", "immutable", "foundation"],
      "stability": "stable",
      "nuget_package": "VSA.Kernel"
    },
    {
      "id": "entity-base",
      "name": "Entity Base Class (DDD Foundation)",
      "category": "kernel",
      "version": "1.0.0",
      "file": "kernel/entity-base.yaml",
      "intent": "識別子による同一性を持つエンティティの基底クラス。ドメインイベント発行機能を含む。",
      "tags": ["kernel", "entity", "ddd", "domain-event", "foundation"],
      "stability": "stable",
      "nuget_package": "VSA.Kernel"
    },
    {
      "id": "validation-behavior",
      "name": "ValidationBehavior",
      "category": "pipeline-behavior",
      "version": "1.3.0",
      "order_hint": 100,
      "file": "patterns/validation-behavior.yaml",
      "intent": "FluentValidation による入力検証を MediatR パイプラインで自動実行",
      "tags": ["validation", "fluent-validation"],
      "stability": "stable",
      "nuget_package": "VSA.Infrastructure"
    },
    {
      "id": "authorization-behavior",
      "name": "AuthorizationBehavior",
      "category": "pipeline-behavior",
      "version": "1.2.1",
      "order_hint": 200,
      "file": "patterns/authorization-behavior.yaml",
      "intent": "ロールベース認可チェックを MediatR パイプラインで自動実行",
      "tags": ["authorization", "security", "role-based"],
      "stability": "stable",
      "nuget_package": "VSA.Infrastructure"
    },
    {
      "id": "idempotency-behavior",
      "name": "IdempotencyBehavior",
      "category": "pipeline-behavior",
      "version": "0.9.0",
      "order_hint": 300,
      "file": "patterns/idempotency-behavior.yaml",
      "intent": "Command の冪等性を保証し、重複実行を防止",
      "tags": ["idempotency", "cache", "reliability"],
      "stability": "beta",
      "nuget_package": "VSA.Infrastructure"
    },
    {
      "id": "caching-behavior",
      "name": "CachingBehavior",
      "category": "pipeline-behavior",
      "version": "1.0.0",
      "order_hint": 350,
      "file": "patterns/caching-behavior.yaml",
      "intent": "Query結果をメモリキャッシュし、パフォーマンスを向上",
      "tags": ["caching", "performance", "query"],
      "stability": "stable",
      "nuget_package": "VSA.Infrastructure"
    },
    {
      "id": "transaction-behavior",
      "name": "TransactionBehavior",
      "category": "pipeline-behavior",
      "version": "2.0.0",
      "order_hint": 400,
      "file": "patterns/transaction-behavior.yaml",
      "intent": "Command を単一トランザクションで実行し、エラー時に自動ロールバック",
      "tags": ["transaction", "entity-framework", "database"],
      "stability": "stable",
      "nuget_package": "VSA.Infrastructure"
    },
    {
      "id": "audit-log-behavior",
      "name": "AuditLogBehavior",
      "category": "pipeline-behavior",
      "version": "1.0.0",
      "order_hint": 550,
      "file": "patterns/audit-log-behavior.yaml",
      "intent": "Command実行の監査ログを自動記録（操作履歴・変更履歴）",
      "tags": ["audit-log", "compliance", "security", "tracking"],
      "stability": "stable",
      "nuget_package": "VSA.Infrastructure"
    },
    {
      "id": "logging-behavior",
      "name": "LoggingBehavior",
      "category": "pipeline-behavior",
      "version": "1.1.0",
      "order_hint": 600,
      "file": "patterns/logging-behavior.yaml",
      "intent": "すべての Command/Query のリクエスト・レスポンス・実行時間をログ出力",
      "tags": ["logging", "observability"],
      "stability": "stable",
      "nuget_package": "VSA.Infrastructure"
    },
    {
      "id": "feature-create-entity",
      "name": "Create Entity Feature Slice",
      "category": "feature-slice",
      "version": "1.0.0",
      "file": "features/feature-create-entity.yaml",
      "intent": "エンティティ作成の完全な垂直スライス（Application + UI + API）",
      "tags": ["feature-slice", "create", "vertical-slice", "full-stack"],
      "stability": "stable"
    },
    {
      "id": "feature-update-entity",
      "name": "Update Entity Feature Slice",
      "category": "feature-slice",
      "version": "1.0.0",
      "file": "features/feature-update-entity.yaml",
      "intent": "エンティティの更新機能（楽観的排他制御・冪等性保証）",
      "tags": ["feature-slice", "update", "edit", "crud", "optimistic-lock"],
      "stability": "stable"
    },
    {
      "id": "feature-delete-entity",
      "name": "Delete Entity Feature Slice",
      "category": "feature-slice",
      "version": "1.0.0",
      "file": "features/feature-delete-entity.yaml",
      "intent": "エンティティの削除機能（論理削除 or 物理削除）",
      "tags": ["feature-slice", "delete", "crud", "soft-delete", "hard-delete"],
      "stability": "stable"
    },
    {
      "id": "feature-search-entity",
      "name": "Search Entity Feature Slice",
      "category": "feature-slice",
      "version": "1.0.0",
      "file": "features/feature-search-entity.yaml",
      "intent": "エンティティ検索・フィルタリング・ページングの完全な垂直スライス",
      "tags": ["feature-slice", "search", "filtering", "paging"],
      "stability": "stable"
    },
    {
      "id": "boundary-pattern",
      "name": "Boundary Pattern (Intent-Boundary分離)",
      "category": "domain-pattern",
      "version": "2.0.0",
      "file": "patterns/boundary-pattern.yaml",
      "intent": "ユーザーとシステムの接点（操作可否判定）をドメイン層に配置し、UIから業務ルールを分離",
      "tags": ["boundary", "intent", "domain", "ui-separation", "business-rule"],
      "stability": "stable",
      "nuget_package": "VSA.Kernel"
    },
    {
      "id": "domain-state-machine",
      "name": "State Machine Pattern",
      "category": "domain-pattern",
      "version": "1.0.0",
      "file": "patterns/domain-state-machine.yaml",
      "intent": "ステートマシンによる状態遷移管理（不正な遷移を防止）",
      "tags": ["state-machine", "state-transition", "domain", "validation"],
      "stability": "stable"
    },
    {
      "id": "domain-typed-id",
      "name": "Typed ID Value Object Pattern",
      "category": "domain-pattern",
      "version": "1.0.0",
      "file": "patterns/domain-typed-id.yaml",
      "intent": "集約固有の強型付けIDで型安全性を確保し、ID取り違えを防止",
      "tags": ["value-object", "typed-id", "aggregate-id", "type-safety", "guid"],
      "stability": "stable",
      "nuget_package": "VSA.Kernel"
    },
    {
      "id": "domain-validation-service",
      "name": "Domain Validation Service Pattern",
      "category": "domain-pattern",
      "version": "1.0.0",
      "file": "patterns/domain-validation-service.yaml",
      "intent": "複数エンティティをまたぐビジネスルール検証をドメインサービスとして実装",
      "tags": ["domain-service", "validation", "business-rule", "overlap-check"],
      "stability": "stable"
    },
    {
      "id": "query-get-list",
      "name": "GetListQuery Pattern",
      "category": "query-pattern",
      "version": "1.0.0",
      "file": "patterns/query-get-list.yaml",
      "intent": "全件取得クエリのテンプレート（キャッシュ対応）",
      "tags": ["query", "cqrs", "cache"],
      "stability": "stable",
      "nuget_package": "VSA.Handlers"
    },
    {
      "id": "query-get-by-id",
      "name": "GetByIdQuery Pattern",
      "category": "query-pattern",
      "version": "1.0.0",
      "file": "patterns/query-get-by-id.yaml",
      "intent": "IDによる単一エンティティ取得クエリのテンプレート（キャッシュ対応）",
      "tags": ["query", "cqrs", "cache", "single"],
      "stability": "stable",
      "nuget_package": "VSA.Handlers"
    },
    {
      "id": "command-create",
      "name": "CreateCommand Pattern",
      "category": "command-pattern",
      "version": "1.0.0",
      "file": "patterns/command-create.yaml",
      "intent": "新規エンティティ作成コマンドのテンプレート",
      "tags": ["command", "cqrs", "create", "idempotency"],
      "stability": "stable",
      "nuget_package": "VSA.Handlers"
    }
  ],
  "ai_decision_matrix": {
    "user_intent_to_pattern": {
      "新機能追加": {
        "pattern_category": "feature-slice",
        "confidence": 0.95,
        "trigger_keywords": ["機能", "追加", "実装", "画面", "できるように"],
        "examples": [
          "商品を作成する機能を追加してください -> feature-create-entity",
          "検索画面を実装してください -> feature-search-entity",
          "顧客を編集できるようにしてください -> feature-update-entity"
        ]
      },
      "システム全体の機能追加": {
        "pattern_category": "pipeline-behavior",
        "confidence": 0.90,
        "trigger_keywords": ["すべて", "全体", "システム", "共通", "横断的"],
        "examples": [
          "すべてのCommandに入力検証を追加してください -> validation-behavior",
          "トランザクション管理を有効にしてください -> transaction-behavior"
        ]
      },
      "重複チェック・競合チェック": {
        "pattern_category": "domain-pattern",
        "confidence": 0.95,
        "trigger_keywords": ["重複", "競合", "チェック", "確認", "同時", "排他"],
        "examples": [
          "予約の重複をチェックしてください -> domain-validation-service",
          "在庫の引当確認をしてください -> domain-validation-service"
        ]
      }
    },
    "fallback_strategy": "判断に迷った場合は feature-slice をデフォルトで選択（垂直スライスが基本）"
  },
  "ai_usage_guide": {
    "how_to_reference": "AI は catalog/index.json を読み込み、必要なパターンの YAML ファイルを取得します",
    "pattern_selection_flow": [
      "1. ユーザーの要求を分析",
      "2. ai_decision_matrix で適切なカテゴリを判定",
      "3. catalog/index.json から該当パターンを検索",
      "4. パターンの YAML ファイルを読み込み",
      "5. ai_selection_hints で最終確認",
      "6. VSA.Framework NuGetパッケージの参照を確認",
      "7. テンプレートを実際のエンティティ名で置換",
      "8. 生成されたコードを提示"
    ],
    "template_variables": {
      "EntityPascalCase": "エンティティ名（PascalCase）例: Product, Order, Customer",
      "EntityCamelCase": "エンティティ名（camelCase）例: product, order, customer",
      "BoundedContext": "境界コンテキスト名（PascalCase）例: ProductCatalog, TaskManagement"
    }
  },
  "version_policy": {
    "stability_levels": {
      "stable": "本番環境で使用可能。破壊的変更はメジャーバージョンアップ時のみ",
      "beta": "機能は動作するが、APIが変更される可能性あり",
      "alpha": "実験的機能。本番環境では使用非推奨"
    },
    "versioning": "セマンティックバージョニング（major.minor.patch）に従います"
  }
}
